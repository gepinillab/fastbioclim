<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating Temporal Averages with `fastbioclim` • fastbioclim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating Temporal Averages with `fastbioclim`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fastbioclim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>[ENGLISH]</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial-1-intro-en.html">Bioclimatics (Intro)</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-2-avg-en.html">Averages</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>[ESPAÑOL]</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial-1-intro-es.html">Bioclimaticas (Intro)</a></li>
    <li><a class="dropdown-item" href="../articles/tutorial-2-avg-es.html">Promedios</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gepinillab/fastbioclim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculating Temporal Averages with `fastbioclim`</h1>
                        <h4 data-toc-skip class="author">Gonzalo E.
Pinilla-Buitrago</h4>
            
            <h4 data-toc-skip class="date">11-08-2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gepinillab/fastbioclim/blob/main/vignettes/tutorial-2-avg-en.Rmd" class="external-link"><code>vignettes/tutorial-2-avg-en.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial-2-avg-en.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In climatic and environmental data analysis, a fundamental task is to
summarize time series of raster data. This allows us, for example, to
calculate “climatologies” or to understand how conditions have changed
over time.</p>
<p>The <code>fastbioclim</code> package offers two powerful and
efficient functions for this task:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/calculate_average.html">calculate_average()</a></code>: Calculates a <strong>static
climatological average</strong>. It answers the question: <em>“What is
the average maximum temperature for all Januaries in my time
series?”</em>.</li>
<li>
<code><a href="../reference/calculate_roll.html">calculate_roll()</a></code>: Calculates a <strong>rolling
climatological average</strong>. It answers the question: <em>“How has
the average for January evolved across different time
windows?”</em>.</li>
</ol>
<p>In this tutorial, we will explore how to use both functions with a
sample dataset of monthly maximum temperature for Belize.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-environment">1. Setting up the Environment<a class="anchor" aria-label="anchor" href="#setting-up-the-environment"></a>
</h2>
<p>Before we begin, we need to load the necessary packages.
<code>fastbioclim</code> is the main package, <code>terra</code> is used
for handling raster data, and <code>progressr</code> along with
<code>future</code> will allow us to see progress bars and run
calculations in parallel for greater efficiency.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gepinillab.github.io/fastbioclim/">fastbioclim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## terra 1.8.60</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure the processing plan. In this example, we'll use sequential processing. OPTIONAL</span></span>
<span><span class="co"># future::plan("sequential")</span></span>
<span></span>
<span><span class="co"># Enable global progress bars to monitor progress. OPTIONAL</span></span>
<span><span class="co"># progressr::handlers(global = TRUE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-the-sample-data">2. Loading the Sample Data<a class="anchor" aria-label="anchor" href="#loading-the-sample-data"></a>
</h2>
<p>We will use a time series of maximum temperature (<code>tmax</code>)
for Belize, which is included in a sample data package. This series
contains 39 years of monthly data (468 layers in total).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the path to the example files</span></span>
<span><span class="co"># system.file() finds files within an installed package</span></span>
<span><span class="va">tmax_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/belize/"</span>, package <span class="op">=</span> <span class="st">"egdata.fastbioclim"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the files as a single terra SpatRaster object</span></span>
<span><span class="va">tmax_bel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">tmax_paths</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's check the structure of our data</span></span>
<span><span class="co"># We should have 468 layers, corresponding to 12 months * 39 years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tmax_bel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## size        : 314, 134, 468  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">## extent      : -89.22514, -88.10847, 15.88319, 18.49986  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">## sources     : 1980-01.tif  </span></span>
<span><span class="co">##               1980-02.tif  </span></span>
<span><span class="co">##               1980-03.tif  </span></span>
<span><span class="co">##               ... and 465 more sources</span></span>
<span><span class="co">## names       : 1980-01, 1980-02, 1980-03, 1980-04, 1980-05, 1980-06, ... </span></span>
<span><span class="co">## min values  :     220,     217,     248,     253,     270,     240, ... </span></span>
<span><span class="co">## max values  :     276,     278,     317,     316,     334,     299, ...</span></span></code></pre>
<p>As we can see, <code>tmax_bel</code> is a <code>SpatRaster</code>
with 468 layers, perfect for our examples.</p>
</div>
<div class="section level2">
<h2 id="static-climatological-averages-with-calculate_average">3. Static Climatological Averages with
<code>calculate_average()</code><a class="anchor" aria-label="anchor" href="#static-climatological-averages-with-calculate_average"></a>
</h2>
<p>This is the most common way to calculate a climatology. We want to
obtain 12 rasters: one for the average of all Januaries, one for all
Februaries, and so on.</p>
<p>The key argument here is <code>index</code>. It is a numeric vector
that tells the function how to group the layers. For our first example,
we will use 30 years of monthly data. To do this, we create an index
that repeats the sequence <code>1, 2, ..., 12</code> thirty times.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will use the first 360 layers for our 30-year example</span></span>
<span><span class="va">tmax_subset</span> <span class="op">&lt;-</span> <span class="va">tmax_bel</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">360</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create the index vector: repeat the sequence 1:12 (months) 30 times (years)</span></span>
<span><span class="va">monthly_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, times <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a temporary directory to save the results</span></span>
<span><span class="va">output_path_static</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"tmax_belize_static_avg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the function</span></span>
<span><span class="co"># progressr will display a progress bar if the operation is lengthy</span></span>
<span><span class="va">tmax_avg_static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_average.html">calculate_average</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tmax_subset</span>,</span>
<span>  index <span class="op">=</span> <span class="va">monthly_index</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">output_path_static</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Allow overwriting if the directory already exists</span></span>
<span>  output_names <span class="op">=</span> <span class="st">"tmax_avg"</span> <span class="co"># Prefix for the output files</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using 'auto' method to select workflow...</span></span>
<span><span class="co">## Data appears to fit in memory. Selecting 'terra' workflow.</span></span>
<span><span class="co">## Calculating averages using terra::tapp...</span></span>
<span><span class="co">## Writing final GeoTIFFs...</span></span>
<span><span class="co">## Processing complete. Final rasters are in: /tmp/Rtmpzc15Va/tmax_belize_static_avg</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The result is a SpatRaster with 12 layers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tmax_avg_static</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## size        : 314, 134, 12  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">## extent      : -89.22514, -88.10847, 15.88319, 18.49986  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">## sources     : tmax_avg_01.tif  </span></span>
<span><span class="co">##               tmax_avg_02.tif  </span></span>
<span><span class="co">##               tmax_avg_03.tif  </span></span>
<span><span class="co">##               ... and 9 more sources</span></span>
<span><span class="co">## names       : tmax_avg_01, tmax_avg_02, tmax_avg_03, tmax_avg_04, tmax_avg_05, tmax_avg_06, ... </span></span>
<span><span class="co">## min values  :    210.1667,    223.0000,    241.6333,       254.8,    258.8667,    251.6000, ... </span></span>
<span><span class="co">## max values  :    276.4000,    296.5667,    321.5667,       336.9,    339.0667,    320.0333, ...</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can visualize the 12 monthly averages</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tmax_avg_static</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-2-avg-en_files/figure-html/static-average-1.png" width="700"></p>
<p>Done! <code>tmax_avg_static</code> now holds the 30-year climatology.
The first layer is the average of all Januaries, the second of all
Februaries, etc.</p>
</div>
<div class="section level2">
<h2 id="rolling-climatological-averages-with-calculate_roll">4. Rolling Climatological Averages with
<code>calculate_roll()</code><a class="anchor" aria-label="anchor" href="#rolling-climatological-averages-with-calculate_roll"></a>
</h2>
<p>What if we want to see if the climate is changing? Instead of a
single average, we can calculate averages for sliding time windows. For
example, the average for years 1-20, then 2-21, 3-22, and so on.</p>
<p>For this, we use <code><a href="../reference/calculate_roll.html">calculate_roll()</a></code>. Its key arguments
are:</p>
<ul>
<li>
<code>window_size</code>: The size of the window (in
<strong>cycles</strong>, e.g., years).</li>
<li>
<code>freq</code>: The number of <strong>units</strong> (layers) per
cycle (e.g., 12 for months in a year).</li>
</ul>
<div class="section level3">
<h3 id="example-1-20-year-window">Example 1: 20-Year Window<a class="anchor" aria-label="anchor" href="#example-1-20-year-window"></a>
</h3>
<p>Let’s calculate the monthly averages for rolling 20-year windows.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an output directory for this analysis</span></span>
<span><span class="va">output_path_rolling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"tmax_belize_rolling_avg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmax_roll_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_roll.html">calculate_roll</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tmax_bel</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">20</span>, <span class="co"># A window of 20 cycles (years)</span></span>
<span>  freq <span class="op">=</span> <span class="fl">12</span>,        <span class="co"># 12 units (months) per cycle</span></span>
<span>  output_dir <span class="op">=</span> <span class="va">output_path_rolling</span>,</span>
<span>  output_prefix <span class="op">=</span> <span class="st">"tmax"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using 'auto' method to select workflow...</span></span>
<span><span class="co">## A single window appears to fit in memory. Selecting 'terra' workflow.</span></span>
<span><span class="co">## Processing window: Cycle 1 to 20</span></span>
<span><span class="co">## Processing window: Cycle 2 to 21</span></span>
<span><span class="co">## Processing window: Cycle 3 to 22</span></span>
<span><span class="co">## Processing window: Cycle 4 to 23</span></span>
<span><span class="co">## Processing window: Cycle 5 to 24</span></span>
<span><span class="co">## Processing window: Cycle 6 to 25</span></span>
<span><span class="co">## Processing window: Cycle 7 to 26</span></span>
<span><span class="co">## Processing window: Cycle 8 to 27</span></span>
<span><span class="co">## Processing window: Cycle 9 to 28</span></span>
<span><span class="co">## Processing window: Cycle 10 to 29</span></span>
<span><span class="co">## Processing window: Cycle 11 to 30</span></span>
<span><span class="co">## Processing window: Cycle 12 to 31</span></span>
<span><span class="co">## Processing window: Cycle 13 to 32</span></span>
<span><span class="co">## Processing window: Cycle 14 to 33</span></span>
<span><span class="co">## Processing window: Cycle 15 to 34</span></span>
<span><span class="co">## Processing window: Cycle 16 to 35</span></span>
<span><span class="co">## Processing window: Cycle 17 to 36</span></span>
<span><span class="co">## Processing window: Cycle 18 to 37</span></span>
<span><span class="co">## Processing window: Cycle 19 to 38</span></span>
<span><span class="co">## Processing window: Cycle 20 to 39</span></span>
<span><span class="co">## Writing final GeoTIFFs...</span></span>
<span><span class="co">## Processing complete. Final rasters are in: /tmp/Rtmpzc15Va/tmax_belize_rolling_avg</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many layers have we created?</span></span>
<span><span class="co"># (39 cycles - 20 window size + 1) * 12 units = 20 * 12 = 240 layers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tmax_roll_avg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## size        : 314, 134, 240  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">## extent      : -89.22514, -88.10847, 15.88319, 18.49986  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">## sources     : tmax_w01-20_u01.tif  </span></span>
<span><span class="co">##               tmax_w01-20_u02.tif  </span></span>
<span><span class="co">##               tmax_w01-20_u03.tif  </span></span>
<span><span class="co">##               ... and 237 more sources</span></span>
<span><span class="co">## names       : tmax_~0_u01, tmax_~0_u02, tmax_~0_u03, tmax_~0_u04, tmax_~0_u05, tmax_~0_u06, ... </span></span>
<span><span class="co">## min values  :       211.6,       223.8,      241.95,      255.55,       259.7,      251.75, ... </span></span>
<span><span class="co">## max values  :       277.0,       296.0,      319.50,      334.80,       340.1,      319.60, ...</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's check the names of the first 13 layers to understand the output</span></span>
<span><span class="co"># We should see the 12 months for the first window (w1-20) and the first of the next</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmax_roll_avg</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "tmax_w01-20_u01" "tmax_w01-20_u02" "tmax_w01-20_u03" "tmax_w01-20_u04"</span></span>
<span><span class="co">##  [5] "tmax_w01-20_u05" "tmax_w01-20_u06" "tmax_w01-20_u07" "tmax_w01-20_u08"</span></span>
<span><span class="co">##  [9] "tmax_w01-20_u09" "tmax_w01-20_u10" "tmax_w01-20_u11" "tmax_w01-20_u12"</span></span>
<span><span class="co">## [13] "tmax_w02-21_u01"</span></span></code></pre>
<p>As you can see, the layer names indicate the window
(<code>w1-20</code>) and the unit index (<code>u</code>).</p>
</div>
<div class="section level3">
<h3 id="example-2-customizing-output-names">Example 2: Customizing Output Names<a class="anchor" aria-label="anchor" href="#example-2-customizing-output-names"></a>
</h3>
<p>The function is highly flexible thanks to the
<code>name_template</code> argument. We can define exactly how we want
our output files to be named.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a more descriptive name template</span></span>
<span><span class="va">custom_template</span> <span class="op">&lt;-</span> <span class="st">"{prefix}_year_{start_window}-{end_window}_month_{idx_unit}"</span></span>
<span></span>
<span><span class="co"># Output directory for the custom names example</span></span>
<span><span class="va">output_path_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"tmax_belize_custom_names"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmax_roll_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_roll.html">calculate_roll</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tmax_bel</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  freq <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">output_path_custom</span>,</span>
<span>  output_prefix <span class="op">=</span> <span class="st">"tmax"</span>,</span>
<span>  name_template <span class="op">=</span> <span class="va">custom_template</span>, <span class="co"># Use our custom template</span></span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using 'auto' method to select workflow...</span></span>
<span><span class="co">## A single window appears to fit in memory. Selecting 'terra' workflow.</span></span>
<span><span class="co">## Processing window: Cycle 1 to 20</span></span>
<span><span class="co">## Processing window: Cycle 2 to 21</span></span>
<span><span class="co">## Processing window: Cycle 3 to 22</span></span>
<span><span class="co">## Processing window: Cycle 4 to 23</span></span>
<span><span class="co">## Processing window: Cycle 5 to 24</span></span>
<span><span class="co">## Processing window: Cycle 6 to 25</span></span>
<span><span class="co">## Processing window: Cycle 7 to 26</span></span>
<span><span class="co">## Processing window: Cycle 8 to 27</span></span>
<span><span class="co">## Processing window: Cycle 9 to 28</span></span>
<span><span class="co">## Processing window: Cycle 10 to 29</span></span>
<span><span class="co">## Processing window: Cycle 11 to 30</span></span>
<span><span class="co">## Processing window: Cycle 12 to 31</span></span>
<span><span class="co">## Processing window: Cycle 13 to 32</span></span>
<span><span class="co">## Processing window: Cycle 14 to 33</span></span>
<span><span class="co">## Processing window: Cycle 15 to 34</span></span>
<span><span class="co">## Processing window: Cycle 16 to 35</span></span>
<span><span class="co">## Processing window: Cycle 17 to 36</span></span>
<span><span class="co">## Processing window: Cycle 18 to 37</span></span>
<span><span class="co">## Processing window: Cycle 19 to 38</span></span>
<span><span class="co">## Processing window: Cycle 20 to 39</span></span>
<span><span class="co">## Writing final GeoTIFFs...</span></span>
<span><span class="co">## Processing complete. Final rasters are in: /tmp/Rtmpzc15Va/tmax_belize_custom_names</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's verify the new names</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmax_roll_custom</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "tmax_year_01-20_month_01" "tmax_year_01-20_month_02"</span></span>
<span><span class="co">##  [3] "tmax_year_01-20_month_03" "tmax_year_01-20_month_04"</span></span>
<span><span class="co">##  [5] "tmax_year_01-20_month_05" "tmax_year_01-20_month_06"</span></span>
<span><span class="co">##  [7] "tmax_year_01-20_month_07" "tmax_year_01-20_month_08"</span></span>
<span><span class="co">##  [9] "tmax_year_01-20_month_09" "tmax_year_01-20_month_10"</span></span>
<span><span class="co">## [11] "tmax_year_01-20_month_11" "tmax_year_01-20_month_12"</span></span>
<span><span class="co">## [13] "tmax_year_02-21_month_01"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="analyzing-the-rolling-average-results">Analyzing the Rolling Average Results<a class="anchor" aria-label="anchor" href="#analyzing-the-rolling-average-results"></a>
</h3>
<p>Visualizing 240 layers at once is not practical. A more interesting
analysis is to see how the average of a specific month has changed
across the different windows.</p>
<p>Let’s extract and visualize all the averages for
<strong>January</strong> (<code>_u01</code>).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select all layers corresponding to January (unit index 01)</span></span>
<span><span class="co"># We use grep() to find the pattern "_u01" in the layer names</span></span>
<span><span class="va">january_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_u01"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmax_roll_avg</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a SpatRaster subset with only the January layers</span></span>
<span><span class="va">rolling_januaries</span> <span class="op">&lt;-</span> <span class="va">tmax_roll_avg</span><span class="op">[[</span><span class="va">january_indices</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Let's rename the layers for clarity (indicating the window)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rolling_januaries</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"January_window_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can visualize the change between the first and last rolling average for January</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rolling_januaries</span><span class="op">[[</span><span class="fl">20</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">rolling_januaries</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial-2-avg-en_files/figure-html/analyze-rolling-1.png" width="700"></p>
<p>This map shows how the average maximum temperature in January has
changed over the last years, allowing us to identify warming or cooling
trends. It’s important to note that the temperature layers used are
scaled by 10. Therefore, some areas show changes of up to 0.8 degrees
Celsius.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>fastbioclim</code> package greatly simplifies the
calculation of temporal summaries for raster time series. * Use
<code><a href="../reference/calculate_average.html">calculate_average()</a></code> for static climatologies over the
entire study period. * Use <code><a href="../reference/calculate_roll.html">calculate_roll()</a></code> to analyze
trends and changes across moving time windows.</p>
<p>Both functions are optimized for efficiency and can leverage parallel
processing to handle large datasets.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gonzalo E. Pinilla-Buitrago, Luis Osorio-Olvera.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
